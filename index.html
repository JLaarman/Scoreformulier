<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dagelijkse Score Tracker — GitHub versie</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* --- CSS: zelfde als eerder, met kleine aanpassingen --- */
* { box-sizing: border-box; }
body { font-family: Arial, Helvetica, sans-serif; margin: 0; background:#f5f7fa; color:#222; }
header { background:#2c3e50; color:white; padding:14px 12px; text-align:center; font-size:1.15rem; }
main { max-width:1100px; margin:18px auto; padding:0 12px 60px 12px; }
/* ... rest van CSS hetzelfde ... */
</style>
</head>
<body>
<header>Dagelijkse Score Tracker — GitHub</header>
<main>
<div class="top-row">
  <div class="date-wrap card">
    <label for="entryDate">Datum</label>
    <input type="date" id="entryDate" />
    <div class="muted small">Kies datum (default = vandaag). Als de datum al bestaat wordt de entry overschreven.</div>
  </div>
  <div class="controls-wrap">
    <button id="saveBtn" class="btn">Opslaan</button>
    <button id="newBtn" class="btn" style="background:#7f8c8d">Nieuw</button>
    <button id="exportCsv" class="small-btn csv-btn">Export CSV</button>
    <select id="periodSelect" class="small" title="Periode filter" style="padding:8px;border-radius:6px;border:1px solid #ddd;">
      <option value="7">Laatste 7 dagen</option>
      <option value="30">Laatste 30 dagen</option>
      <option value="all" selected>Alle data</option>
    </select>
  </div>
</div>

<form class="grid" id="mainForm" onsubmit="return false;">
  <!-- parameters, hetzelfde als jouw laatste versie -->
  <div class="card">
    <label for="slaapkwaliteit">Slaapkwaliteit (0–10)</label>
    <input type="number" id="slaapkwaliteit" min="0" max="10" />
  </div>
  <div class="card">
    <label for="ochtendstijfheid">Ochtendstijfheid (0–10)</label>
    <input type="number" id="ochtendstijfheid" min="0" max="10" />
  </div>
  <div class="card">
    <label for="pijnscore">Pijnscore voeten (0–10)</label>
    <input type="number" id="pijnscore" min="0" max="10" />
  </div>
  <div class="card">
    <label for="kilometers">Kilometers gelopen</label>
    <input type="number" id="kilometers" min="0" step="0.1" />
  </div>
  <!-- extra parameters -->
  <div class="card">
    <label for="energielevel">Energielevel (0–10)</label>
    <input type="number" id="energielevel" min="0" max="10" />
  </div>
  <div class="card">
    <label for="rusthartslag">Rusthartslag (bpm)</label>
    <input type="number" id="rusthartslag" min="30" max="220" />
  </div>
  <div class="card">
    <label for="spiervermoeidheid">Spiervermoeidheid benen (0–10)</label>
    <input type="number" id="spiervermoeidheid" min="0" max="10" />
  </div>
  <div class="card">
    <label for="stressniveau">Stressniveau (0–10)</label>
    <input type="number" id="stressniveau" min="0" max="10" />
  </div>
  <div class="card">
    <label for="voeding">Voeding op orde (0–10)</label>
    <input type="number" id="voeding" min="0" max="10" />
  </div>
  <div class="card">
    <label for="slaaptijd">Slaaptijd (uur)</label>
    <input type="number" id="slaaptijd" min="0" step="0.1" />
  </div>
  <div class="card">
    <label for="opmerking">Opmerking (optioneel)</label>
    <input type="text" id="opmerking" placeholder="Bijv. extra hersteltijd, pijn detail..." />
  </div>
</form>

<div class="chart-area">
  <div class="chart-controls">
    <div class="chart-checkboxes card" style="display:flex; gap:10px; align-items:center;">
      <div class="small muted">Toon lijnen:</div>
      <div id="checkboxContainer" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
    </div>
    <div style="flex:1"></div>
    <div class="muted small">Periode:</div>
    <select id="periodSelectTop" class="small" style="padding:6px;border-radius:6px;border:1px solid #ddd;">
      <option value="7">7 dagen</option>
      <option value="30">30 dagen</option>
      <option value="all" selected>Alle data</option>
    </select>
  </div>

  <div class="chart-container">
    <canvas id="trendChart"></canvas>
    <button id="fullscreenBtn" title="Volledig scherm">⛶ Volledig scherm</button>
  </div>
</div>

<div class="table-wrap" style="margin-top:16px;">
  <table id="logTable">
    <thead>
      <tr>
        <th>Datum</th>
        <th>Pijn</th>
        <th>Km</th>
        <th>Slaap</th>
        <th>Acties</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="overlay" id="chartOverlay">
  <div class="overlay-content">
    <div class="overlay-top">
      <div style="font-weight:700">Trendoverzicht — fullscreen</div>
      <div class="legend-controls" id="overlayCheckboxes"></div>
      <div>
        <button id="closeOverlay" class="small-btn" style="background:#c0392b;color:white;">Sluit (ESC)</button>
      </div>
    </div>
    <div class="overlay-canvas">
      <canvas id="fullscreenChart"></canvas>
    </div>
  </div>
</div>

<script>
/***********************
 * CONFIG
 ***********************/
const WEBAPP_URL = 'https://script.google.com/macros/s/.../exec'; // vul je eigen Apps Script URL in
const paramConfig = [
  { id:'slaap', label:'Slaapkwaliteit', field:'slaap', color:'#2980b9', visible:true },
  { id:'stijfheid', label:'Ochtendstijfheid', field:'stijfheid', color:'#e67e22', visible:true },
  { id:'pijn', label:'Pijnscore voeten', field:'pijn', color:'#c0392b', visible:true },
  { id:'km', label:'Kilometers', field:'km', color:'#27ae60', visible:true },
  { id:'energie', label:'Energielevel', field:'energie', color:'#8e44ad', visible:false },
  { id:'hr', label:'Rusthartslag', field:'hr', color:'#2c3e50', visible:false },
  { id:'spier', label:'Spiervermoeidheid', field:'spier', color:'#d35400', visible:false },
  { id:'stress', label:'Stressniveau', field:'stress', color:'#7f8c8d', visible:false },
  { id:'voeding', label:'Voeding op orde', field:'voeding', color:'#16a085', visible:false }
];

/***********************
 * ELEMENTS
 ***********************/
const entryDate = document.getElementById('entryDate');
const inputs = {
  slaap: document.getElementById('slaapkwaliteit'),
  stijfheid: document.getElementById('ochtendstijfheid'),
  pijn: document.getElementById('pijnscore'),
  km: document.getElementById('kilometers'),
  energie: document.getElementById('energielevel'),
  hr: document.getElementById('rusthartslag'),
  spier: document.getElementById('spiervermoeidheid'),
  stress: document.getElementById('stressniveau'),
  voeding: document.getElementById('voeding'),
  slaaptijd: document.getElementById('slaaptijd'),
  opmerking: document.getElementById('opmerking')
};
const saveBtn = document.getElementById('saveBtn');
const newBtn = document.getElementById('newBtn');
const exportCsvBtn = document.getElementById('exportCsv');
const tableBody = document.querySelector('#logTable tbody');
const checkboxContainer = document.getElementById('checkboxContainer');
const overlayCheckboxes = document.getElementById('overlayCheckboxes');
const periodSelect = document.getElementById('periodSelect');
const periodSelectTop = document.getElementById('periodSelectTop');
const chartCanvas = document.getElementById('trendChart');
const fullscreenCanvas = document.getElementById('fullscreenChart');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const overlay = document.getElementById('chartOverlay');
const closeOverlay = document.getElementById('closeOverlay');

/***********************
 * STATE
 ***********************/
let scores = [];
let chart = null;
let fullscreenChart = null;

/***********************
 * UTILS
 ***********************/
function setDefaultDate() {
  const today = new Date().toISOString().slice(0,10);
  entryDate.value = today;
}

function loadFormData(dateStr) {
  const entry = scores.find(e => e.date === dateStr);
  if(entry){
    for(const key in inputs) if(inputs[key]) inputs[key].value = entry[key] ?? '';
  } else {
    for(const key in inputs) if(inputs[key]) inputs[key].value = '';
  }
}

/***********************
 * FETCH / SAVE
 ***********************/
async function fetchScoresFromGitHub() {
  try{
    const resp = await fetch(WEBAPP_URL);
    return await resp.json();
  } catch(e){ console.error('Fetch error:', e); return []; }
}

async function saveScoresToGitHub(data) {
  try{
    const resp = await fetch(WEBAPP_URL,{
      method:'POST',
      body: JSON.stringify(data)
    });
    return await resp.json();
  } catch(e){ console.error('Save error:', e); return {status:'error'}; }
}

/***********************
 * TABLE & CHART
 ***********************/
function renderTable() {
  tableBody.innerHTML='';
  const period = periodSelect.value==='all'?Infinity:parseInt(periodSelect.value);
  const filtered = scores.slice(-period);
  filtered.forEach(row=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${row.date}</td><td>${row.pijn||0}</td><td>${row.km||0}</td><td>${row.slaap||0}</td>
    <td><button onclick="deleteEntry('${row.date}')">❌</button></td>`;
    tableBody.appendChild(tr);
  });
}

function renderChart() {
  const labels = scores.map(s=>s.date);
  const datasets = paramConfig.filter(p=>p.visible).map(p=>({
    label:p.label,
    data:scores.map(s=>s[p.field]||0),
    borderColor:p.color,
    backgroundColor:'transparent'
  }));
  if(chart) chart.destroy();
  chart = new Chart(chartCanvas,{type:'line',data:{labels,datasets},options:{responsive:true}});
}

/***********************
 * EVENTS
 ***********************/
saveBtn.addEventListener('click', async ()=>{
  const dateStr = entryDate.value;
  const entry = {date:dateStr};
  for(const key in inputs) entry[key] = inputs[key].value || '';
  const index = scores.findIndex(e=>e.date===dateStr);
  if(index>=0) scores[index]=entry; else scores.push(entry);
  await saveScoresToGitHub(scores);
  renderTable(); renderChart();
});

newBtn.addEventListener('click', ()=>{setDefaultDate(); loadFormData(entryDate.value);});

exportCsvBtn.addEventListener('click', ()=>{
  const csv = ['Datum,'+paramConfig.map(p=>p.label).join(',')].concat(
    scores.map(s=>[s.date,...paramConfig.map(p=>s[p.field]||'')].join(','))
  ).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='scores.csv'; a.click(); URL.revokeObjectURL(url);
});

/***********************
 * INIT
 ***********************/
async function init(){
  setDefaultDate();
  scores = await fetchScoresFromGitHub();
  loadFormData(entryDate.value);
  renderTable();
  renderChart();
}
init();
</script>
</body>
</html>
